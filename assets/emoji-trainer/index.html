<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
            crossorigin="anonymous"></script>
    <style>
        #display_emoji {
            font-size: 10em;
        }

        #output_score_right,
        #output_score_wrong {
            font-size: 1.5em;
        }

    </style>
</head>

<body>
    <div class="container-sm px-4 py-4 text-center">
        <header class="pb-3 mb-4 border-bottom">
            <a href="/"
               class="d-flex align-items-center text-dark text-decoration-none">
                <span class="fs-4">üèãÔ∏è‚Äç‚ôÄÔ∏è Emoji Trainer</span>
            </a>
        </header>
        <div class="row justify-content-md-center">
            <div class="col-sm-4 col-md-10 col-lg-4 mb-3">
                <div class="card">
                    <div class="card-header">
                        <div class="row my-2 justify-content-center">
                            <div class="col-auto">
                                <label for="select_level"
                                       class="col-form-label">Difficulty</label>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <select id="select_level"
                                            class="form-select">
                                        <option selected
                                                value="easy">üë∂ Easy</option>
                                        <option value="medium">üë¶ Medium</option>
                                        <option value="hard">üë®‚Äçüîß Hard</option>
                                        <option value="hard">üë®‚Äçüè´ Expert</option>
                                        <option value="hard">üòà Impossible</option>
                                        <option value="flags">üá¨üáß Flags</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row justify-content-md-center">
                            <div class="col col-sm-6">
                                <div id="output_score_right"
                                     class="p-2 mb-2 alert alert-success text-center">0</div>
                            </div>
                            <div class="col col-sm-6">
                                <div id="output_score_wrong"
                                     class="p-2 mb-2 alert alert-danger text-center">0</div>
                            </div>
                        </div>
                        <div class="row justify-content-md-center">
                            <div class="col col-sm-12">
                                <div class="text-center">
                                    <div id="display_emoji"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-md-center">
                            <div class="col col-sm-10 col-md-9 d-flex justify-content-center h-100">
                                <div class="form-group">
                                    <input class="form-control"
                                           type="text"
                                           name="input_answer"
                                           id="input_answer"
                                           placeholder="Type the name ..." />
                                </div>
                                <button type="submit"
                                        id="input_submit"
                                        class="btn btn-primary ms-3">Submit</button>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col col-12 d-flex justify-content-center h-100">
                                <div class="alert py-1 px-3"
                                     role="alert"
                                     id="output_result">
                                </div>
                                <div id="spinner"
                                     class="d-inline ms-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-10 col-lg-5 mb-3">
                <div class="h-100 p-5 bg-light border rounded-3">
                    <h2>üèãÔ∏è‚Äç‚ôÄÔ∏è Emoji Trainer</h2>
                    <hr>
                    <p>Emojis can be printed using their respective
                        <a href="https://cldr.unicode.org/translation/characters/short-names-and-keywords"
                           target="_blank">CLDR short names </a>.
                        For example if you type <code>:smile</code>
                        the output will be üòÑ, or <code>:scream_cat</code> for üôÄ
                    </p>
                    <p>CLDR short names are standar for most applications like Whatsapp, Slack or Github.</p>
                    <p>üí™ Become an emoji expert with this trainer, save time and levearage all the emoji power.</p>
                    <p>
                        <a class="twitter-share-button"
                           href="https://twitter.com/intent/tweet?text=üèãÔ∏è‚Äç‚ôÄÔ∏è%20Become%20an%20emoji%20expert%20at"
                           data-size="large">
                            Tweet</a>
                        <a href="https://twitter.com/rcougil"
                           class="twitter-follow-button"
                           data-size="large"
                           data-show-count="false">Follow @rcougil</a>
                        <script async
                                src="https://platform.twitter.com/widgets.js"
                                charset="utf-8"></script>
                    </p>
                </div>
            </div>
        </div>
        <footer class="pt-3 mt-4 text-muted border-top">
            ¬© 2023
        </footer>
    </div>
</body>

<script>

    var emojis = [];
    var levels = [];

    var emoji = "";
    var level = "";

    async function getEmojis() {
        return await fetch('https://raw.githubusercontent.com/github/gemoji/master/db/emoji.json')
            .then((response) => response.json());
    }

    async function getLevels() {
        return await fetch('./level.json')
            .then((response) => response.json());
    }

    function getRandomEmoji(emojis) {
        var emoji;
        do {
            emoji = emojis[Math.random() * emojis.length | 0];
        } while (levels[level].includes(emoji['category']) == false)
        return emoji;
    }

    (async () => {

        var emoji;
        var score_wrong = 0;
        var score_right = 0;
        var attempt = 0;

        document.getElementById('input_submit').addEventListener("click", function (event) {
            event.preventDefault();
            console.log("value")
            var answer = document.getElementById('input_answer').value;
            submitAnswer(answer);
        });

        document.getElementById('input_answer').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                submitAnswer(event.target.value)
            }
        });

        function submitAnswer(answer) {
            console.log(emoji['aliases'])
            console.log(answer)
            document.getElementById("input_answer").disabled = true;
            document.getElementById("input_submit").disabled = true;
            if (emoji['aliases'].includes(answer.toLowerCase())) {
                document.getElementById("output_score_right").innerHTML = ++score_right;
                document.getElementById("output_result").classList.add("alert-success");
                document.getElementById("output_result").innerHTML = 'OK!'

            } else {
                document.getElementById("output_score_wrong").innerHTML = ++score_wrong;
                document.getElementById("output_result").classList.add("alert-danger");
                document.getElementById("output_result").innerHTML = emoji['aliases'].join(" ,")
            }

            document.getElementById("spinner").innerHTML = '<div class="spinner-border text-secondary text-center" role="status"></div>';
            setTimeout(() => {
                document.getElementById("input_answer").value = "";
                document.getElementById("output_result").classList.remove("alert-danger");
                document.getElementById("output_result").classList.remove("alert-success");
                document.getElementById("output_result").innerHTML = "";
                document.getElementById("spinner").innerHTML = "";
                next()
            }, 2000)
        }

        document.getElementById("select_level").addEventListener('change', function (event) {
            level = event.target.value;
            next()
        })

        async function next() {
            levels = await getLevels();
            level = document.getElementById("select_level").value;
            emoji = getRandomEmoji(emojis)
            document.getElementById("display_emoji").innerHTML = emoji["emoji"];
            document.getElementById("input_answer").disabled = false;
            document.getElementById("input_submit").disabled = false;
            document.getElementById("input_answer").focus();
            console.log(emoji['aliases']);
        }

        async function main() {
            emojis = await getEmojis();
            next()
        }

        main();

    })();

</script>

<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));</script>

</html>
